# 测试环境配置 - 使用 PostgreSQL
spring:
  application:
    name: rag-qa-system-test

  # 服务器配置（与主应用保持一致）
  web:
    resources:
      add-mappings: false

  # 使用 PostgreSQL 数据库进行测试
  datasource:
    url: jdbc:postgresql://${TEST_DB_HOST:localhost}:${TEST_DB_PORT:5432}/${TEST_DB_NAME:rag_qa_system_test}
    username: ${TEST_DB_USERNAME:postgres}
    password: ${TEST_DB_PASSWORD:123456}
    driver-class-name: org.postgresql.Driver
    hikari:
      pool-name: Test-HikariPool
      maximum-pool-size: 5

  # JPA配置
  jpa:
    database-platform: org.hibernate.dialect.PostgreSQLDialect
    hibernate:
      ddl-auto: create-drop
    show-sql: true
    properties:
      hibernate:
        format_sql: true

  # 启用Flyway（测试环境也使用迁移）
  flyway:
    enabled: true
    locations: classpath:db/migration
    baseline-on-migrate: true
    baseline-version: 0
    clean-disabled: false  # 测试环境允许clean

# 服务器配置（与主应用保持一致）
server:
  servlet:
    context-path: /api

  # 禁用DemoUserInitializer
  main:
    allow-bean-definition-overriding: true

# JWT配置（使用测试密钥）
# 密钥必须 >= 512位(64字节)以支持HS512算法
jwt:
  secret: VGVzdFByb2R1Y3Rpb25LZXkxMjM0NTY3ODkwMTIzNDU2Nzg5MDEyMzQ1Njc4OTAxMjM0NTY3ODkwMTIzNDU2Nzg5MA==
  access-token:
    expiration: 300000  # 5分钟
  refresh-token:
    expiration: 1800000  # 30分钟

# 禁用实际服务
aliyun:
  ocr:
    enabled: false

langchain4j:
  modelscope:
    api-key: test-api-key
    base-url: https://api.siliconflow.cn/v1
    chat-model: deepseek-ai/DeepSeek-V3
    embedding-model: Qwen/Qwen3-Embedding-0.6B
    temperature: 0.7
    max-tokens: 2048

# 日志配置
logging:
  level:
    root: INFO
    com.hiyuan: DEBUG
